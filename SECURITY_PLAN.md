# План безопасности приложения NotesApp
## На основе приложений из ПР4 и настроек из ПР5

### 1. Цели и требования безопасности

**Стратегические цели:**
1. Защита конфиденциальности пользовательских данных
2. Обеспечение целостности и доступности системы
3. Соответствие требованиям OWASP Top 10 и ФСТЭК

**Тактические задачи:**
1. Предотвращение утечек данных
2. Защита от web-уязвимостей
3. Контроль доступа к ресурсам
4. Регулярный мониторинг и аудит

### 2. Оценка угроз (на основе проведённых тестов)

#### 2.1. Выявленные уязвимости в ходе тестирования:

| Угроза | Критичность | Статус | Метод выявления |
|--------|-------------|--------|-----------------|
| SQL-инъекции | Высокая | ✅ Исправлено | Ручное тестирование, SQLMap |
| Отсутствие CSP | Высокая | ✅ Исправлено | OWASP ZAP |
| Отсутствие X-Frame-Options | Высокая | ✅ Исправлено | OWASP ZAP |
| CSRF-уязвимости | Средняя | ✅ Исправлено | OWASP ZAP |
| Утечка информации о сервере | Средняя | ✅ Исправлено | OWASP ZAP |
| Небезопасные настройки PostgreSQL | Высокая | ✅ Исправлено | Ручная проверка |

#### 2.2. Потенциальные угрозы:
1. **Атаки на аутентификацию** (брутфорс, credential stuffing)
2. **Недостаточная авторизация** (IDOR, privilege escalation)
3. **Уязвимости зависимостей** (устаревшие библиотеки)
4. **Недостаточное логирование** (отсутствие аудита безопасности)
5. **DDoS-атаки** на приложение и базу данных

### 3. Перечень реализованных мер защиты

#### 3.1. Уровень приложения (Flask):
- ✅ Защита от SQL-инъекций через SQLAlchemy ORM
- ✅ CSRF-защита через Flask-WTF
- ✅ HTTP security headers (CSP, HSTS, X-Frame-Options)
- ✅ Хэширование паролей (bcrypt через werkzeug)
- ✅ Сессионные cookies с флагами HttpOnly и SameSite
- ✅ Валидация входных данных через WTForms

#### 3.2. Уровень базы данных (PostgreSQL):
- ✅ Ограничение подключений по IP (pg_hba.conf)
- ✅ Обязательное SSL/TLS шифрование
- ✅ Пользователь с минимальными привилегиями
- ✅ Отзыв прав у PUBLIC
- ✅ Шифрование трафика TLSv1.3

#### 3.3. Уровень инфраструктуры:
- ✅ Брандмауэр iptables для фильтрации трафика
- ✅ Запуск через Gunicorn с кастомным server_name
- ✅ Изоляция в виртуальном окружении

### 4. План регулярного тестирования

#### 4.1. Статический анализ безопасности (SAST):
- **Инструмент:** Bandit
- **Частота:** При каждом коммите (CI/CD)
- **Область проверки:** Весь исходный код Python
- **Критерии успеха:** Отсутствие high/critical уязвимостей

#### 4.2. Динамический анализ (DAST):
- **Инструмент:** OWASP ZAP
- **Частота:** Еженедельно (автоматизированно)
- **Область проверки:** Все endpoints приложения
- **Критерии успеха:** Отсутствие high/critical уязвимостей

#### 4.3. Тестирование на проникновение:
- **Метод:** Полуавтоматическое тестирование
- **Частота:** Ежемесячно
- **Область проверки:** Аутентификация, авторизация, бизнес-логика
- **Инструменты:** SQLMap, Burp Suite, ручное тестирование

#### 4.4. Проверка зависимостей:
- **Инструмент:** pip-audit, dependabot
- **Частота:** Еженедельно
- **Критерии:** Отсутствие уязвимостей в зависимостях

#### 4.5. График тестирования:

| Тип тестирования | Частота | Ответственный | Метрики |
|-----------------|---------|---------------|---------|
| SAST (Bandit) | Каждый коммит | CI/CD система | 0 high/critical |
| DAST (ZAP) | Еженедельно | DevOps инженер | <5 medium |
| Пентест | Ежемесячно | Security team | Устранение 90% уязвимостей |
| Аудит зависимостей | Еженедельно | CI/CD система | 0 известных уязвимостей |

### 5. Политика реагирования на инциденты

#### 5.1. Классификация инцидентов:
- **Критический:** Компрометация данных, SQL-инъекция
- **Высокий:** XSS, CSRF, утечка информации
- **Средний:** Информационные уязвимости
- **Низкий:** Рекомендации по улучшению

#### 5.2. Процесс обработки:
1. **Обнаружение:** Мониторинг, тестирование, пользователи
2. **Оценка:** Определение критичности и влияния
3. **Содержание:** Изоляция, временные меры
4. **Устранение:** Разработка и деплой исправлений
5. **Анализ:** Постмортем, улучшение процессов

### 6. Требования к разработке (Secure SDLC)

#### 6.1. Обязательные практики:
1. Code review с фокусом на безопасность
2. Параметризованные запросы к БД (запрет строковой конкатенации)
3. Валидация всех пользовательских входных данных
4. Использование подготовленных шаблонов с CSRF-защитой
5. Шифрование чувствительных данных

#### 6.2. Запрещённые практики:
1. Отладочный режим в production (debug=True)
2. Хранение секретов в коде
3. Использование устаревших криптографических библиотек
4. Отправка ошибок с stack trace пользователям

### 7. Мониторинг и логирование

#### 7.1. Собираемые логи:
- Неудачные попытки входа
- SQL-запросы с длительным временем выполнения
- Изменения конфигурации безопасности
- Доступ к критическим endpoints

#### 7.2. Системы мониторинга:
- **Логи:** ELK Stack (Elasticsearch, Logstash, Kibana)
- **Метрики:** Prometheus + Grafana
- **Оповещения:** Slack/Telegram для критических инцидентов

### 8. План улучшений на следующий квартал

1. Внедрение WAF (Web Application Firewall)
2. Реализация 2FA для администраторов
3. Внедрение системы управления секретами (HashiCorp Vault)
4. Регулярные тренировки по реагированию на инциденты
5. Сертификация PCI DSS (если потребуется)

---

**Версия документа:** 1.0  
**Дата создания:** 07.12.2025  
**Ответственный:** Семенова Г.В.  
**Следующий пересмотр:** 07.03.2026
